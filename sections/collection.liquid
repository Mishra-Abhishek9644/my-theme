{% comment %}
  Collection template – styled like Featured Products cards
{% endcomment %}

<section class="bg-white px-12 py-10">
  <!-- Collection Heading -->
  <div class="text-black flex flex-col justify-center items-center gap-3 mb-12">
    <h1 class="text-4xl font-semibold">
      {{ collection.title }}
    </h1>
  </div>

  <!-- Collection Toolbar -->
  <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
    <!-- Left: Filter + Count -->
    <div class="flex items-center gap-6 text-sm text-gray-700">
      <button
        type="button"
        onclick="openFilters()"
        class="flex items-center gap-2 text-sm hover:text-black"
      >
        ☰ Filter
      </button>

      <span> We found {{ collection.products_count }} products available for you. </span>
    </div>
    <!-- Filter Overlay -->
    <div
      id="filter-overlay"
      class="fixed inset-0 bg-black/40 z-40 hidden"
      onclick="closeFilters()"
    ></div>

    <!-- Right: Sort -->
    <form method="get">
      <select
        name="sort_by"
        onchange="this.form.submit()"
        class="border rounded-md px-4 py-2 text-sm"
      >
        {% for option in collection.sort_options %}
          <option
            value="{{ option.value }}"
            {% if option.value == collection.sort_by %}
              selected
            {% endif %}
          >
            {{ option.name }}
          </option>
        {% endfor %}
      </select>
    </form>
  </div>

  <!-- Filter Drawer -->
  <aside
    id="filter-drawer"
    class="
      fixed top-0 left-0 h-full w-[320px] bg-white z-50
      transform -translate-x-full transition-transform duration-300
      overflow-y-auto
    "
  >
    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-4 border-b">
      <h2 class="text-lg font-semibold">Filter</h2>
      <button onclick="closeFilters()" class="text-xl">×</button>
    </div>

    <!-- Filters -->
    <form method="get" class="p-6 space-y-8">
      {% for filter in collection.filters %}
        <div>
          <h3 class="font-medium mb-4">
            {{ filter.label }}
          </h3>

          {% case filter.type %}
              <!-- PRICE SLIDER -->
            {% when 'price_range' %}
              <div class="space-y-4">
                <div class="text-sm text-gray-600">Price</div>

                <div class="flex items-center gap-3">
                  <!-- Min price -->
                  <input
                    type="number"
                    name="{{ filter.min_value.param_name }}"
                    placeholder="Min"
                    value="{{ filter.min_value.value }}"
                    min="0"
                    max="10000"
                    class="w-full border px-3 py-2 rounded-md text-sm"
                  >

                  <span class="text-gray-400">—</span>

                  <!-- Max price -->
                  <input
                    type="number"
                    name="{{ filter.max_value.param_name }}"
                    placeholder="Max"
                    value="{{ filter.max_value.value }}"
                    min="0"
                    max="10000"
                    class="w-full border px-3 py-2 rounded-md text-sm"
                  >
                </div>

                <!-- Apply button -->
                <button
                  type="submit"
                  class="text-sm underline text-left"
                >
                  Apply
                </button>
              </div>

              <!-- COLOR / LIST FILTERS -->
            {% when 'list' %}
              <ul class="space-y-2">
                {% for value in filter.values %}
                  <li>
                    <label
                      class="
                        flex items-center gap-3 text-sm cursor-pointer
                        border rounded-md px-3 py-2 transition
                        {% if value.active %}
                          border-black bg-gray-50
                        {% else %}
                          border-transparent
                        {% endif %}
                      "
                    >
                      <input
                        type="checkbox"
                        name="{{ value.param_name }}"
                        value="{{ value.value }}"
                        {% if value.active %}
                          checked
                        {% endif %}
                        {% if value.count == 0 and value.active == false %}
                          disabled
                        {% endif %}
                        class="sr-only"
                        onchange="this.form.submit()"
                      >

                      <!-- Color dot -->
                      <span
                        class="w-4 h-4 rounded-full border"
                        style="background-color: {{ value.label | downcase }};"
                      ></span>

                      <span class="flex-1"> {{ value.label }} ({{ value.count }}) </span>
                    </label>
                  </li>
                {% endfor %}
              </ul>
          {% endcase %}
        </div>
      {% endfor %}

      <button
        type="submit"
        class="w-full bg-black text-white py-3 rounded-md"
      >
        Apply filters
      </button>
    </form>
  </aside>

  {% paginate collection.products by 12 %}
    <!-- Products Grid -->
    <div class="max-w-8xl mx-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
      {% for product in collection.products %}
        <a
          href="{{ product.url }}"
          class="group block flex flex-col justify-center gap-2 items-center h-[520px]"
        >
          <!-- Product Image -->
          <div class="h-[420px] w-full bg-gray-100 overflow-hidden rounded-md">
            {% if product.featured_image %}
              <img
                src="{{ product.featured_image | image_url: width: 800 }}"
                alt="{{ product.title | escape }}"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                height=""
                width=""
              >
            {% endif %}
          </div>

          <!-- Product Info -->
          <div class="mt-4 text-center">
            <h3 class="text-lg font-medium text-black">
              {{ product.title }}
            </h3>

            <p class="text-gray-700 mt-1">
              {{ product.price | money }}
            </p>
          </div>
        </a>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <nav class="flex items-center justify-center m-2 gap-2 text-sm">
      {% if paginate.previous %}
        <a
          href="{{ paginate.previous.url }}"
          class="px-4 py-2 border rounded-md hover:bg-black hover:text-white transition"
        >
          ← Prev
        </a>
      {% endif %}

      {% for part in paginate.parts %}
        {% if part.is_link %}
          <a
            href="{{ part.url }}"
            class="px-4 py-3 border rounded-full hover:bg-black hover:text-white transition"
          >
            {{ part.title }}
          </a>
        {% else %}
          <span
            class="px-4 py-3 border rounded-full bg-black text-white"
          >
            {{ part.title }}
          </span>
        {% endif %}
      {% endfor %}

      {% if paginate.next %}
        <a
          href="{{ paginate.next.url }}"
          class="px-4 py-2 border rounded-md hover:bg-black hover:text-white transition"
        >
          Next →
        </a>
      {% endif %}
    </nav>
  {% endpaginate %}
</section>

{% schema %}
{
  "name": "Collection",
  "settings": []
}
{% endschema %}

<script>
  function openFilters() {
    document.getElementById('filter-drawer').classList.remove('-translate-x-full');
    document.getElementById('filter-overlay').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeFilters() {
    document.getElementById('filter-drawer').classList.add('-translate-x-full');
    document.getElementById('filter-overlay').classList.add('hidden');
    document.body.style.overflow = '';
  }
</script>
