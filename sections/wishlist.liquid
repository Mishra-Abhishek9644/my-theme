<section class="bg-white px-6 lg:px-16 py-16">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-semibold mb-10">
      Your Wishlist ❤️
    </h1>

    <div id="wishlist-wrapper"></div>
  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];
  let wrapper = document.getElementById("wishlist-wrapper");

  if (wishlist.length === 0) {
    wrapper.innerHTML = `
      <div class="text-center py-20">
        <p class="text-lg text-gray-600 mb-6">
          Your wishlist is currently empty.
        </p>
        <a href="{{ routes.all_products_collection_url }}"
          class="inline-block bg-black text-white px-8 py-3 rounded-md">
          Continue shopping
        </a>
      </div>`;
    return;
  }

  let res = await fetch("/products.json?limit=250");
  let data = await res.json();

  let html = `<div class="divide-y border-t border-b">`;

  wishlist.forEach(id => {
    let product = data.products.find(p => p.id == id);
    if (!product) return;

    html += `
      <div class="py-6 flex gap-6 items-center">
        <div class="w-24 h-24 bg-gray-100 rounded-md overflow-hidden">
          <img src="${product.images[0]?.src}" class="w-full h-full object-cover">
        </div>

        <div class="flex-1">
          <a href="/products/${product.handle}"
            class="text-lg font-medium hover:underline">
            ${product.title}
          </a>

          <p class="text-sm mt-2">₹${product.variants[0].price}</p>

          <button class="remove-wishlist underline text-sm mt-2"
            data-id="${product.id}">
            Remove
          </button>
        </div>
      </div>`;
  });

  html += `</div>`;
  wrapper.innerHTML = html;

  document.querySelectorAll(".remove-wishlist").forEach(btn => {
    btn.addEventListener("click", () => {
      wishlist = wishlist.filter(x => x !== btn.dataset.id);
      localStorage.setItem("wishlist", JSON.stringify(wishlist));
      location.reload();
    });
  });

});
</script>
